<html>
  <head>
    <title>Example quiz</title>
    <style>
      div.quiz, p.comment, div.explanation {display:inline;}
      strong.correct {color:#14B63F;}
      strong.incorrect {color:rgb(255,0,0);}
      strong.mark {color:rgb(255,128,0);}
      input.correct {color:#14B63F; font-weight: bold;}
      input.incorrect {color:rgb(255,0,0); font-weight: bold;}
      div.btn-footer {text-align: center;}
      div.explanation {font-style: italic;}
      div.col1 {
        float: left;
        margin-right: 50px;
      }
      div.col2, div.col2sm {
        float: left;
      }
      div.col3 {
        float: left;
        margin-left: 50px;
      }
      div.clear-qdd {
        clear: left;
      }
      input.input-qddmc {
        line-height: 1.7;
        margin-bottom: 3;
      }
      button.button-qddmc, button.button-qddsm {
        margin-bottom: 3px;
      }
      button.button-qddsm {
        margin-left: 1px;
        margin-right: 1px;      
      }
      div.dragdropsm {
        background-color: #FFF;
        width: 600px;
        height: 30px;
        margin-bottom: 3;
        border-radius: 5;
        border-style: solid;
        border-width: 1px;
      }
    </style>
    <style type="text/css">
    .context-menu-list {
      margin:0; 
      padding:0;
      
      min-width: 160px;
      max-width: 250px;
      display: inline-block;
      position: absolute;
      list-style-type: none;
      
      border: 1px solid #DDD;
      background: #EEE;
      
      -webkit-box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        -moz-box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
          -ms-box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
          -o-box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
              box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
      
      font-family: Verdana, Arial, Helvetica, sans-serif;
      font-size: 15px;
    }

    .context-menu-item {
        padding: 2px 2px 2px 24px;
        background-color: #EEE;
        color: #000;
        position: relative;
        -webkit-user-select: none;
          -moz-user-select: -moz-none;
            -ms-user-select: none;
                user-select: none;
    }

    .context-menu-separator {
        padding-bottom:0;
        border-bottom: 1px solid #DDD;
    }

    .context-menu-item > label > input,
    .context-menu-item > label > textarea {
        -webkit-user-select: text;
          -moz-user-select: text;
            -ms-user-select: text;
                user-select: text;
    }

    .context-menu-item.hover {
        cursor: pointer;
        background-color: #428bca;
        color: #FFF;
    }

    .context-menu-item.disabled {
        color: #666;
    }

    .context-menu-input.hover,
    .context-menu-item.disabled.hover {
        cursor: default;
        background-color: #EEE;
    }

    .context-menu-submenu:after {
        content: ">";
        color: #666;
        position: absolute;
        top: 2;
        right: 3px;
        z-index: 1;
    }

    /* vertically align inside labels */
    .context-menu-input > label > * { vertical-align: top; }

    .context-menu-input > label > span {
        margin-left: 5px;
    }

    .context-menu-input > label,
    .context-menu-input > label > input[type="text"],
    .context-menu-input > label > textarea,
    .context-menu-input > label > select {
        display: block;
        width: 100%;
        
        -webkit-box-sizing: border-box;
          -moz-box-sizing: border-box;
            -ms-box-sizing: border-box;
            -o-box-sizing: border-box;
                box-sizing: border-box;
    }

    .context-menu-input > label > textarea {
        height: 100px;
    }
    .context-menu-item > .context-menu-list {
        display: none;
        /* re-positioned by js */
        right: -5px;
        top: 5px;
    }

    .context-menu-item.hover > .context-menu-list {
        display: block;
    }

    .context-menu-accesskey {
        text-decoration: underline;
    }
    </style>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <script type="text/javascript">
MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});    </script>
    <script type="text/javascript" src="http://medialize.github.com/jQuery-contextMenu/src/jquery.ui.position.js">
    </script>
    <script type="text/javascript" src="http://medialize.github.com/jQuery-contextMenu/src/jquery.contextMenu.js">
    </script>
    <script type="text/javascript">

      $(document).mousedown(function(e){ 
        if( e.button == 2 ) {
          id_answer = e.toElement.id;
          if (id_answer.match(/^qfi/)) {
            numQuestion = parseInt(id_answer.split('-')[0].slice(3)) - 1;
            try {
              if (data["question-" + numQuestion.toString()]['answers'][id_answer]['type'] != "JS") {
                answer = data["question-" + numQuestion.toString()]['answers'][id_answer]['answer_text'];
                $.contextMenu({
                  selector: "#" + id_answer,
                  items: {
                    "fold1": {
                      "name": "Mostrar respuesta", 
                      "items": {
                        "fold1-key1": {"name": answer}
                      }
                    }
                  }
                }, null, { 'sizeStyle': 'auto' });
              }
            }
            catch(err) {}
          }
        };
      });
        </script>
    <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.1.0/codemirror.css"/>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.1.0/codemirror.min.js">
    </script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.1.0/package/mode/javascript/javascript.js">
    </script>
  </head>
  <body>
    <!-- Seed: 204000882055767548123385001123782339180 -->
    <form id="form">
      <ol class="questions">
        <li id="question-0" class="question fillin ">
          <div class="quiz text">
[1 point] <i>Example of escaped HTML and three hyphens not evaluated:</i><br> &lt;a href=&quot;www.google.es&quot;&gt;&lt;/a&gt; <b>is</b> a --- <input type="text" id="qfi1-1" class="fillin size-4"></input> ---<div id="qfi1-1r" class="quiz"></div></br></br>          </div>
          <button type="button" id="q-0" class="btn btn-primary btn-sm">
Enviar          </button>
          <br>
          </br>
        </li>
        <li id="question-1" class="question fillin ">
          <div class="quiz text">
[2 points] The visionary founder of Apple is <input type="text" id="qfi2-1" class="fillin size-8"></input><div id="qfi2-1r" class="quiz"></div></br></br>          </div>
          <p class="comment">
Question too easy<br></br>          </p>
          <button type="button" id="q-1" class="btn btn-primary btn-sm">
Enviar          </button>
          <br>
          </br>
        </li>
        <li id="question-2" class="question fillin ">
          <div class="quiz text">
[1 point] The <input type="text" id="qfi3-1" class="fillin size-4"></input> brown fox jumped over the lazy <input type="text" id="qfi3-2" class="fillin size-4"></input><div id="qfi3-2r" class="quiz"></div></br></br>          </div>
          <button type="button" id="q-2" class="btn btn-primary btn-sm">
Enviar          </button>
          <br>
          </br>
        </li>
        <li id="question-3" class="question dragdrop_fi ">
          <div class="quiz text">
[1 point] The <input id="qddfi4-1" class="dragdropfi size-4" ondrop="drop(event,'qddfi4-1', true)" ondragover="allowDrop(event)"></input> brown fox jumped over the lazy <input id="qddfi4-2" class="dragdropfi size-4" ondrop="drop(event,'qddfi4-2', true)" ondragover="allowDrop(event)"></input><br/><br/><div> Respuestas: <button class="dragdropfi size-3 btn btn-default btn-sm" id="qddfia1-1" draggable="true" ondragstart="drag(event)">fox</button>&nbsp&nbsp<button class="dragdropfi size-3 btn btn-default btn-sm" id="qddfia2-2" draggable="true" ondragstart="drag(event)">dog</button>&nbsp&nbsp<div/></br></br>          </div>
          <button type="button" id="q-3" class="btn btn-primary btn-sm">
Enviar          </button>
          <br>
          </br>
        </li>
        <li id="question-4" class="question fillin ">
          <div class="quiz text">
[1 point] The three stooges are <input type="text" id="qfi5-1" class="fillin size-5"></input>, <input type="text" id="qfi5-2" class="fillin size-4"></input>, and <input type="text" id="qfi5-3" class="fillin size-5"></input>.<div id="qfi5-3r" class="quiz"></div></br></br>          </div>
          <button type="button" id="q-4" class="btn btn-primary btn-sm">
Enviar          </button>
          <br>
          </br>
        </li>
        <li id="question-5" class="question fillin ">
          <div class="quiz text">
[1 point] The three stooges are <input type="text" id="qfi6-1" class="fillin size-5"></input>, <input type="text" id="qfi6-2" class="fillin size-4"></input>, and <input type="text" id="qfi6-3" class="fillin size-5"></input>.<div id="qfi6-3r" class="quiz"></div></br></br>          </div>
          <button type="button" id="q-5" class="btn btn-primary btn-sm">
Enviar          </button>
          <br>
          </br>
        </li>
        <li id="question-6" class="question fillin ">
          <div class="quiz text">
[1 point] The capital of Tenerife is <input type="text" id="qfi7-1" class="fillin size-5"></input> Cruz de <input type="text" id="qfi7-2" class="fillin size-8"></input><div id="qfi7-2r" class="quiz"></div></br></br>          </div>
          <button type="button" id="q-6" class="btn btn-primary btn-sm">
Enviar          </button>
          <br>
          </br>
        </li>
        <li id="question-7" class="question fillin ">
          <div class="quiz text">
[1 point] 
      Diga dos números x = <input type="text" id="qfi8-1" class="fillin size-4"></input> e  y = <input type="text" id="qfi8-2" class="fillin size-4"></input> que multiplicados den 100
    <div id="qfi8-2r" class="quiz"></div></br></br>          </div>
          <button type="button" id="q-7" class="btn btn-primary btn-sm">
Enviar          </button>
          <br>
          </br>
        </li>
        <li id="question-8" class="question programming ">
          <div class="quiz text">
[1 point] Escriba una función JavaScript llamada `suma` que recibe dos números 
    y devuelve la suma<br></br>          </div>
          <ol class="answers">
            <textarea id="qp9-1" class="programming" rows="5" cols="80" height="800" width="150" placeholder="Escribe tu código aquí...">
            </textarea>
            <br/>
            <br/>
          </ol>
        </li>
        <button type="button" id="q-8" class="btn btn-primary btn-sm">
Enviar        </button>
        <br>
        </br>
        <li id="question-9" class="question fillin ">
          <div class="quiz text">
[1 point] 
      Calculate the determinant of this matrix:
      $$\mathbf{A} = \begin{vmatrix} 
      1 & 3 \\ 
      2 & 4 
      \end{vmatrix}$$
      <br/>
      <input type="text" id="qfi10-1" class="fillin size-4"></input>
    <div id="qfi10-1r" class="quiz"></div></br></br>          </div>
          <button type="button" id="q-9" class="btn btn-primary btn-sm">
Enviar          </button>
          <br>
          </br>
        </li>
        <li id="question-10" class="question fillin ">
          <div class="quiz text">
[1 point] 
      Solve: 
      $$\binom{n}{k} = \frac{n!}{k!(n-k)!}$$
      when n = 5 and k = 2:
      <input type="text" id="qfi11-1" class="fillin size-4"></input>
    <div id="qfi11-1r" class="quiz"></div></br></br>          </div>
          <button type="button" id="q-10" class="btn btn-primary btn-sm">
Enviar          </button>
          <br>
          </br>
        </li>
        <li id="question-11" class="question fillin ">
          <div class="quiz text">
[1 point] 
      When x = 2, the solution of $\sqrt{3x+3}+(1+x)^2$ is:
      <input type="text" id="qfi12-1" class="fillin size-4"></input>
    <div id="qfi12-1r" class="quiz"></div></br></br>          </div>
          <button type="button" id="q-11" class="btn btn-primary btn-sm">
Enviar          </button>
          <br>
          </br>
        </li>
        <li id="question-12" class="question multiplechoice ">
          <div class="quiz text">
[1 point] What is the largest US state?<br></br>          </div>
          <ol class="answers">
            <input type="radio" id="qmc13-1" name="qmc13" class="select">
Texas<br class=qmc13-1br>            </input>
            <div id="qmc13-1r" class="quiz">
            </div>
            <input type="radio" id="qmc13-2" name="qmc13" class="select">
Hawaii<br class=qmc13-2br>            </input>
            <div id="qmc13-2r" class="quiz">
            </div>
            <input type="radio" id="qmc13-3" name="qmc13" class="select">
Alaska<br class=qmc13-3br>            </input>
            <div id="qmc13-3r" class="quiz">
            </div>
            <br/>
          </ol>
        </li>
        <button type="button" id="show-answer-q-12" class="btn btn-success btn-sm">
Mostrar respuesta        </button>
        <button type="button" id="q-12" class="btn btn-primary btn-sm">
Enviar        </button>
        <br>
        </br>
        <li id="question-13" class="question dragdrop_mc ">
          <div class="quiz text">
[1 point] Relate these concepts<br></br>          </div>
          <ol class="answers">
            <div>
              <div id="col1" class="col1">
                <button class="btn btn-default btn-sm disabled button-qddmc" draggable="false">
Facebook                </button>
                <br/>
                <button class="btn btn-default btn-sm disabled button-qddmc" draggable="false">
Twitter                </button>
                <br/>
              </div>
              <div id="col2" class="col2">
                <input id="qddmc14-1" type="text" class="dragdropmc input-qddmc" ondrop="drop(event, 'qddmc14-1', true)" ondragover="allowDrop(event)"/>
                <br/>
                <input id="qddmc14-2" type="text" class="dragdropmc input-qddmc" ondrop="drop(event, 'qddmc14-2', true)" ondragover="allowDrop(event)"/>
                <br/>
              </div>
              <div id="col3" class="col3">
                <button id="qddmca14-1" class="btn btn-default btn-sm button-qddmc" draggable="true" ondragstart="drag(event)">
Jack Dorsey                </button>
                <br/>
                <button id="qddmca14-2" class="btn btn-default btn-sm button-qddmc" draggable="true" ondragstart="drag(event)">
Mark Zuckerberg                </button>
                <br/>
              </div>
            </div>
            <div class="clear-qdd"/>
            <br/>
          </ol>
        </li>
        <button type="button" id="q-13" class="btn btn-primary btn-sm">
Enviar        </button>
        <br>
        </br>
        <li id="question-14" class="question selectmultiple multiple">
          <div class="quiz text">
[1 point] Select ALL that apply: Which are American political parties?<br></br>          </div>
          <ol class="answers">
            <input type="checkbox" id="qsm15-1" class="check">
Democrats<br class=qsm15-1br>            </input>
            <div id="qsm15-1r" class="quiz">
            </div>
            <input type="checkbox" id="qsm15-2" class="check">
Republicans<br class=qsm15-2br>            </input>
            <div id="qsm15-2r" class="quiz">
            </div>
            <input type="checkbox" id="qsm15-3" class="check">
Greens<br class=qsm15-3br>            </input>
            <div id="qsm15-3r" class="quiz">
            </div>
            <input type="checkbox" id="qsm15-4" class="check">
Tories<br class=qsm15-4br>            </input>
            <div id="qsm15-4r" class="quiz">
            </div>
            <input type="checkbox" id="qsm15-5" class="check">
Social Democrats<br class=qsm15-5br>            </input>
            <div id="qsm15-5r" class="quiz">
            </div>
            <br/>
          </ol>
        </li>
        <button type="button" id="show-answer-q-14" class="btn btn-success btn-sm">
Mostrar respuesta        </button>
        <button type="button" id="q-14" class="btn btn-primary btn-sm">
Enviar        </button>
        <br>
        </br>
        <li id="question-15" class="question dragdrop_sm multiple">
          <div class="quiz text">
[1 point] Select ALL that apply: Relate these concepts<br></br>          </div>
          <ol class="answers">
            <div>
              <div id="col1" class="col1">
                <button class="btn btn-default btn-sm disabled button-qddsm" draggable="false">
Ruby                </button>
                <br/>
                <button class="btn btn-default btn-sm disabled button-qddsm" draggable="false">
JavaScript                </button>
                <br/>
              </div>
              <div id="col2" class="col2sm">
                <div id="qddsm16-1" type="text" class="dragdropsm" ondrop="drop(event, 'qddsm16-1', false)" ondragover="allowDrop(event)">
                </div>
                <div id="qddsm16-2" type="text" class="dragdropsm" ondrop="drop(event, 'qddsm16-2', false)" ondragover="allowDrop(event)">
                </div>
              </div>
              <div class="clear-qdd"/>
              <br/>
              <div id="answers_qddsm" ondrop="drop(event, 'answers_qddsm', false)" ondragover="allowDrop(event)">
Respuestas:                 <button id="qddsma16-1" class="btn btn-default btn-sm button-qddsm" draggable="true" ondragstart="drag(event)">
Sinatra                </button>
                <button id="qddsma16-2" class="btn btn-default btn-sm button-qddsm" draggable="true" ondragstart="drag(event)">
jQuery                </button>
                <button id="qddsma16-3" class="btn btn-default btn-sm button-qddsm" draggable="true" ondragstart="drag(event)">
Rails                </button>
              </div>
            </div>
            <br/>
          </ol>
        </li>
        <button type="button" id="q-15" class="btn btn-primary btn-sm">
Enviar        </button>
        <br>
        </br>
        <li id="question-16" class="question truefalse ">
          <div class="quiz text">
[1 point] True or False: The earth is flat.<br></br>          </div>
          <ol class="answers">
            <br/>
          </ol>
        </li>
        <button type="button" id="q-16" class="btn btn-primary btn-sm">
Enviar        </button>
        <br>
        </br>
        <li id="question-17" class="question multiplechoice ">
          <div class="quiz text">
[1 point] What does the following code do:
    <pre>
    puts "Hello world!"
    </pre>
              </div>
          <ol class="answers">
            <input type="radio" id="qmc18-1" name="qmc18" class="select">
Throws an exception<br class=qmc18-1br>            </input>
            <div id="qmc18-1r" class="quiz">
            </div>
            <input type="radio" id="qmc18-2" name="qmc18" class="select">
Prints a friendly message<br class=qmc18-2br>            </input>
            <div id="qmc18-2r" class="quiz">
            </div>
            <br/>
          </ol>
        </li>
        <button type="button" id="show-answer-q-17" class="btn btn-success btn-sm">
Mostrar respuesta        </button>
        <button type="button" id="q-17" class="btn btn-primary btn-sm">
Enviar        </button>
        <br>
        </br>
      </ol>
      <div id="score" class="score">
      </div>
      <div class="btn-footer">
        <button type="button" id="submit" class="btn btn-primary">
Enviar        </button>
        <button type="button" id="reset" class="btn btn-info">
Reset        </button>
        <button type="button" id="deleteAnswers" class="btn btn-warning">
Borrar respuestas        </button>
        <button type="button" id="deleteStorage" class="btn btn-danger">
Borrar almacenamiento        </button>
      </div>
    </form>
    <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.0.min.js">
    </script>
<!--[if lt IE 8]>    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js">
    </script>
<![endif]-->    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/xregexp/2.0.0/xregexp-min.js">
    </script>
    <script type="text/javascript">

      id_textareas = {};
      $("textarea").each(function() { 
        id_textareas[this.id] = {};
        id_textareas[this.id]['id'] = this.id;
        id_textareas[this.id]['height'] = parseInt(this.attributes['4'].value);
        id_textareas[this.id]['width'] = parseInt(this.attributes['5'].value);
      });
      
      $.each(id_textareas, function(k,v) {
        id_textareas[k]['editor'] = CodeMirror.fromTextArea(document.getElementById(k), {
          lineNumbers: true,
          viewportMargin: Infinity
        });
        id_textareas[k]['editor'].setSize(id_textareas[k]['height'], id_textareas[k]['width']);
        id_textareas[k]['editor'].setValue('');
      });
        </script>
    <script type="text/javascript">
      function allowDrop(ev) {
        ev.preventDefault();
      }
      
      function drag(ev) {
        ev.dataTransfer.setData("Text",ev.target.id);
      }
      
      function drop(ev, id, clone) {
        ev.preventDefault();
        var data=ev.dataTransfer.getData("Text");
        if (clone)
          ev.target.appendChild(document.getElementById(data).cloneNode(true));
        else
          ev.target.appendChild(document.getElementById(data));
        var val=document.getElementById(id);
        val.value=document.getElementById(data).innerText;
      }
    </script>
    <script type="text/javascript">
      i18n = {"es":{"quiz":{"title":"Cuestionario"},"questions":{"correct":"Correcto","incorrect":"Incorrecto","points":"puntos","score":"Puntuaci&oacute;n total","placeholder":"Escribe tu código aquí"},"answers":"Respuestas","buttons":{"submit":"Enviar","reset":"Reset","delete":"Borrar respuestas","deleteAll":"Borrar almacenamiento","show":"Mostrar respuesta","hide":"Ocultar respuesta"},"alerts":{"answers":"Respuestas borradas","storage":"Almacenamiento borrado","noStorage":"El navegador no soporta almacenamiento de respuestas"},"exceptions":{"question":"Pregunta","text":"No se ha especificado el texto de la pregunta","answer":"No se ha especificado ninguna respuesta"}}}
    </script>
    <script type="text/javascript">
      data = {"question-0":{"question_text":"<i>Example of escaped HTML and three hyphens not evaluated:</i><br> &lt;a href=&quot;www.google.es&quot;&gt;&lt;/a&gt; <b>is</b> a \\-\\-\\- ---- \\-\\-\\-","answers":{"qfi1-1":{"answer_text":"/^link$/","correct":true,"explanation":null,"type":"Regexp"}},"points":1,"order":true,"question_comment":""},"question-1":{"question_text":"The visionary founder of Apple is --------","answers":{"qfi2-1":{"answer_text":"/^ste(ve|phen)\\s+jobs #comment $/ixm","correct":true,"explanation":null,"type":"Regexp"},"qfi2-2":{"answer_text":"/^steve\\s+wozniak/i","correct":false,"explanation":"Almost, but not quite.","type":"Regexp"}},"points":2,"order":true,"question_comment":"Question too easy"},"question-2":{"question_text":"The ---- brown fox jumped over the lazy ----","answers":{"qfi3-1":{"answer_text":"/fox/","correct":true,"explanation":"This sentence contains all of the letters of the English Alphabet","type":"Regexp"},"qfi3-2":{"answer_text":"/dog/","correct":true,"explanation":"This sentence contains all of the letters of the English Alphabet","type":"Regexp"}},"points":1,"order":true,"question_comment":""},"question-3":{"question_text":"The ---- brown fox jumped over the lazy ----","answers":{"qddfi4-1":{"answer_text":"fox","correct":true,"explanation":"This sentence contains all of the letters of the English Alphabet","type":"String"},"qddfi4-2":{"answer_text":"dog","correct":true,"explanation":"This sentence contains all of the letters of the English Alphabet","type":"String"}},"points":1,"order":true,"question_comment":""},"question-4":{"question_text":"The three stooges are -----, ----, and -----.","answers":{"qfi5-1":{"answer_text":"larry","correct":true,"explanation":null,"type":"String"},"qfi5-2":{"answer_text":"moe","correct":true,"explanation":null,"type":"String"},"qfi5-3":{"answer_text":"curly","correct":true,"explanation":null,"type":"String"}},"points":1,"order":true,"question_comment":""},"question-5":{"question_text":"The three stooges are -----, ----, and -----.","answers":{"qfi6-1":{"answer_text":"larry","correct":true,"explanation":null,"type":"String"},"qfi6-2":{"answer_text":"moe","correct":true,"explanation":null,"type":"String"},"qfi6-3":{"answer_text":"curly","correct":true,"explanation":null,"type":"String"}},"points":1,"order":false,"question_comment":""},"question-6":{"question_text":"The capital of Tenerife is ----- Cruz de --------","answers":{"qfi7-1":{"answer_text":"/Santa/i","correct":true,"explanation":null,"type":"Regexp"},"qfi7-2":{"answer_text":"/Tenerife/i","correct":true,"explanation":null,"type":"Regexp"}},"points":1,"order":true,"question_comment":""},"question-7":{"question_text":"\n      Diga dos números x = ---- e  y = ---- que multiplicados den 100\n    ","answers":{"qfi8-1":{"answer_text":"result = function(x,y) { return (x * y === 100); }","correct":true,"explanation":null,"type":"JS"}},"points":1,"order":true,"question_comment":""},"question-8":{"question_text":"Escriba una función JavaScript llamada `suma` que recibe dos números \n    y devuelve la suma","answers":{"qp9-1":{"answer_text":"function () { \n  if (suma(3,4) == 7) \n    return true;\n  else\n    return false;\n}","correct":true,"explanation":null}},"points":1,"question_comment":"","language":"javascript","height":800,"width":150},"question-9":{"question_text":"\n      Calculate the determinant of this matrix:\n      $$\\mathbf{A} = \\begin{vmatrix} \n      1 & 3 \\\\ \n      2 & 4 \n      \\end{vmatrix}$$\n      <br/>\n      ----\n    ","answers":{"qfi10-1":{"answer_text":-1,"correct":true,"explanation":null,"type":"Fixnum"}},"points":1,"order":true,"question_comment":""},"question-10":{"question_text":"\n      Solve: \n      $$\\binom{n}{k} = \\frac{n!}{k!(n-k)!}$$\n      when n = 5 and k = 2:\n      ----\n    ","answers":{"qfi11-1":{"answer_text":10,"correct":true,"explanation":null,"type":"Fixnum"},"qfi11-2":{"answer_text":9,"correct":false,"explanation":"Not exactly","type":"Fixnum"}},"points":1,"order":true,"question_comment":""},"question-11":{"question_text":"\n      When x = 2, the solution of $\\sqrt{3x+3}+(1+x)^2$ is:\n      ----\n    ","answers":{"qfi12-1":{"answer_text":12,"correct":true,"explanation":null,"type":"Fixnum"},"qfi12-2":{"answer_text":11,"correct":false,"explanation":"Try again!","type":"Fixnum"}},"points":1,"order":true,"question_comment":""},"question-12":{"question_text":"What is the largest US state?","answers":{"qmc13-1":{"answer_text":"Texas","correct":false,"explanation":"That's pretty big, but think colder."},"qmc13-2":{"answer_text":"Hawaii","correct":false,"explanation":"Not big enough."},"qmc13-3":{"answer_text":"Alaska","correct":true,"explanation":null}},"points":1,"question_comment":""},"question-13":{"question_text":"Relate these concepts","answers":{"qddmc14-1":{"answer_text":{"Facebook":"Mark Zuckerberg"},"correct":true,"explanation":null,"type":"Hash"},"qddmc14-2":{"answer_text":{"Twitter":"Jack Dorsey"},"correct":true,"explanation":null,"type":"Hash"}},"points":1,"question_comment":""},"question-14":{"question_text":"Which are American political parties?","answers":{"qsm15-1":{"answer_text":"Democrats","correct":true,"explanation":null},"qsm15-2":{"answer_text":"Republicans","correct":true,"explanation":null},"qsm15-3":{"answer_text":"Greens","correct":true,"explanation":"Yes, they're a party!"},"qsm15-4":{"answer_text":"Tories","correct":false,"explanation":"They're British"},"qsm15-5":{"answer_text":"Social Democrats","correct":false,"explanation":""}},"points":1,"question_comment":""},"question-15":{"question_text":"Relate these concepts","answers":{"qddsm16-1":{"answer_text":{"Ruby":["Sinatra","Rails"]},"correct":true,"explanation":null,"type":"Hash"},"qddsm16-2":{"answer_text":{"JavaScript":"jQuery"},"correct":true,"explanation":null,"type":"Hash"}},"points":1,"question_comment":""},"question-16":{"question_text":"True or False: The earth is flat.","answers":{"qddmc17-1":{"answer_text":"True","correct":false,"explanation":"No, just looks that way","type":"Hash"},"qddmc17-2":{"answer_text":"False","correct":true,"explanation":null,"type":"Hash"}},"points":1,"question_comment":""},"question-17":{"question_text":"What does the following code do:\n    <pre>\n    puts \"Hello world!\"\n    </pre>\n    ","answers":{"qmc18-1":{"answer_text":"Throws an exception","correct":false,"explanation":"Don't be an idiot."},"qmc18-2":{"answer_text":"Prints a friendly message","correct":true,"explanation":null}},"points":1,"question_comment":""}};
      timestamp = 1399332296
      timestamp = timestamp.toString();
      language = 'es';
      totalPoints = 19;
      userPoints = 0;
      
      function findCorrectAnswer(idQuestion, questionType) {
        correctIds = [];
        for (id in data[idQuestion]['answers']) {
          if(data[idQuestion]['answers'][id.toString()]['correct'] == true)
            if (questionType == 0)
              return id.toString();
            else {
              correctIds.push(id.toString());
            } 
        }
        return correctIds;
      }
      
      function checkSelectMultiple(x, checkedIds, correctIds) {
        results = [];
        
        $.each(checkedIds, function(index, value){
          if (correctIds.indexOf(value) == -1) {
            results.push(false);
            printResults(value, 0, data[x.toString()]['answers'][value]['explanation'], 0);
          }
          else {
            results.push(true);
            printResults(value, 1, data[x.toString()]['answers'][value]['explanation'], 0);
          }
        });
        
        nCorrects = 0;
        nIncorrects = 0;
        $.each(results, function(index, value){
          if (value == true)
            nCorrects += 1;
          else
            nIncorrects += 1;
        });
        
        userPoints += calculateMark(data[x.toString()], x.toString(), null, 3, nCorrects, nIncorrects);
      }
      
      function printResults(id, type, explanation, typeQuestion) {
        if (typeQuestion == 0) {                                        // MultipleChoice and SelectMultiple
          $("br[class=" + id + "br" + "]").detach();
          if (type == 1) {
            if ((explanation == "") || (explanation == null))
              $("div[id ~= " + id + "r" + "]").html("<strong class=correct> " + i18n[language]['questions']['correct'] + "</strong></br>");
            else
              $("div[id ~= " + id + "r" + "]").html("<strong class=correct> " + i18n[language]['questions']['correct'] + " - " + explanation + "</strong></br>");
          }
          else {
            if ((explanation == "") || (explanation == null))
              $("div[id ~= " + id + "r" + "]").html("<strong class=incorrect> " + i18n[language]['questions']['incorrect'] + "</strong></br>");
            else
              $("div[id ~= " + id + "r" + "]").html("<strong class=incorrect> " + i18n[language]['questions']['incorrect'] + " - " + explanation + "</strong></br>");
          }
        }
        else {          // FillIn
          for (r in id) {
            input = $("#" + r.toString());
            if (id[r] == true) {
              input.attr('class', input.attr('class') + ' correct');
            }
            else { 
              if ((id[r] == false) || (id[r] != "n/a")) {
                input.attr('class', input.attr('class') + ' incorrect');
              }
            }
            
            if ((id[r] != true) && (id[r] != false) && (id[r] != "n/a")) {
              if (explanation[id[r].toString()] != null)
                $("div[id ~= " + r.toString() + "r" + "]").html(" <div class=explanation>" + explanation[id[r].toString()] + "</div>");
            }
            else {
              if (explanation[r] != null)
                $("div[id ~= " + r + "r" + "]").html(" <div class=explanation>" + explanation[r] + "</div>");
            }
          }
        }
      }
      
      function calculateMark(question, id, result, typeQuestion, numberCorrects, numberIncorrects) {
        stringPoints = i18n[language]['questions']['points'];
        if (typeQuestion == 2) {
          if (result) {
            $("#" + id).append("<strong class=mark> " + question['points'].toFixed(2) + "/" + question['points'].toFixed(2) + " " + stringPoints + "</strong></br></br>");
            
            return parseFloat(question['points']);
          }
          else {
            $("#" + id).append("<strong class=mark> 0.00/" + question['points'].toFixed(2) + " " + stringPoints + "</strong></br></br>");
            
            return parseFloat(0);
          }
        }
        else if (typeQuestion == 1) {
          size = 0;
          for (y in question['answers'])
            if (question['answers'][y]['correct'] == true)
              size += 1;
              
          pointsUser = ((question['points'] / size) * numberCorrects).toFixed(2);
          $("#" + id).append("<strong class=mark> " + pointsUser + "/" + question['points'].toFixed(2) + " " + stringPoints + "</strong></br></br>");
         
          return parseFloat(pointsUser);
        }
        else {
          totalCorrects = 0;
          for (y in question['answers']) {
            if (question['answers'][y]['correct'] == true)
              totalCorrects += 1;
          }
          
          correctAnswerPoints = question['points'] / totalCorrects;
          penalty = correctAnswerPoints * numberIncorrects;
          mark = (correctAnswerPoints * numberCorrects) - penalty;
          
          if (mark < 0)
            mark = 0;
            
          $("#" + id).append("<strong class=mark> " + mark.toFixed(2) + "/" + question['points'].toFixed(2) + " " + stringPoints + "</strong></br></br>");        
          
          return parseFloat(mark);
        }
      }
      
      function checkFillin(correctAnswers, userAnswers, distractorAnswers, typeCorrection) {
        correction = {};
        checkedAnswers = {};
        
        if (typeCorrection == 0) {          // Order doesn't matter
          for (u in userAnswers) {
            if (userAnswers[u] != undefined) {    // No empty field
              matchedCorrect = false;
              for (y in correctAnswers) {
                if (checkAnswers[u] == undefined) {
                  if ((typeof(correctAnswers[y]) == "string") || (typeof(correctAnswers[y]) == "number")) {    // Answer is a String or a Number
                    if (userAnswers[u] == correctAnswers[y]) {
                      correction[u] = true;
                      checkedAnswers[u] = userAnswers[u];
                      matchedCorrect = true;
                      break;
                    }
                  }
                  else {  // Answer is a Regexp
                    if (XRegExp.exec(userAnswers[u], correctAnswers[y])) {
                      correction[u] = true;
                      checkedAnswers[u] = userAnswers[u];
                      matchedCorrect = true;
                      break;
                    }
                  }
                }
              }
              if (!matchedCorrect)
                correction[u] = false;
            }
            else
              correction[u] = "n/a";
          }
        }
        else {                            // Order matters
          for (u in userAnswers) {
            if (userAnswers[u] != undefined) {
              if ((typeof(correctAnswers[u]) == "string") || (typeof(correctAnswers[u]) == "number")) {
                if (userAnswers[u] == correctAnswers[u])
                  correction[u] = true;
                else
                  correction[u] = false;
              }
              else {
                if (XRegExp.exec(userAnswers[u], correctAnswers[u]))
                  correction[u] = true;
                else
                  correction[u] = false;
              }
            }
            else
              correction[u] = "n/a";
          }
        }
        
        if (Object.keys(userAnswers).length == 1) {
          for (u in userAnswers) {
            if (correction[u] == false) {
              for (y in distractorAnswers) {
                if ((typeof(distractorAnswers[y]) == "string") || (typeof(distractorAnswers[y]) == "number")) {
                  if (userAnswers[u] == distractorAnswers[y])
                    correction[u] = y.toString();
                }
                else {
                  if (XRegExp.exec(userAnswers[u], distractorAnswers[y]))
                    correction[u] = y.toString();
                }
              }
            }
          }
        }
        return correction;
      }
      
      function checkAnswer(x) {
        
        if ($("#" + x.toString() + " strong").length == 0) {
          correct = false;
          answers = $("#" + x.toString() + " input");
          
          if (answers.length != 0) {
            if ((answers.attr('class').match("fillin")) || (answers.attr('class').match("dragdropfi")) || (answers.attr('class').match("dragdropmc"))) {
              correctAnswers = {};
              distractorAnswers = {};
              explanation = {};
              stringAnswer = false;
              flag_js = false;
              
              for (ans in data[x.toString()]['answers']) {
                if (data[x.toString()]['answers'][ans]['correct'] == true) {
                  if (data[x.toString()]['answers'][ans]['type'] == "Regexp") {
                    string = data[x.toString()]['answers'][ans]['answer_text'].split('/');
                    regexp = string[1];
                    options = string[2];
                    correctAnswers[ans.toString()] = XRegExp(regexp, options);
                  }
                  else if (data[x.toString()]['answers'][ans]['type'] == "JS") {
                    flag_js = true;
                  }
                  else if (data[x.toString()]['answers'][ans]['type'] == "Hash") {
                    key = (Object.keys(data[x.toString()]['answers'][ans]['answer_text'])).join();
                    correctAnswers[ans.toString()] = data[x.toString()]['answers'][ans]['answer_text'][key];
                  }
                  else { // String or Number
                    correctAnswers[ans.toString()] = data[x.toString()]['answers'][ans]['answer_text'];
                    stringAnswer = true;
                  }
                }
                else {
                  if (data[x.toString()]['answers'][ans]['type'] == "Regexp") {
                    string = data[x.toString()]['answers'][ans]['answer_text'].split('/');
                    regexp = string[1];
                    options = string[2];
                    distractorAnswers[ans.toString()] = XRegExp(regexp, options);
                  }
                  else if (data[x.toString()]['answers'][ans]['type'] == "JS") {
                    //
                  }
                  else {// String or Number
                    distractorAnswers[ans.toString()] = data[x.toString()]['answers'][ans]['answer_text'];
                    stringAnswer = true;
                  }
                }
                explanation[ans] = data[x.toString()]['answers'][ans]['explanation'];
              }
              
              userAnswers = {};
              for (i = 0; i < answers.length; i++) {
                if (answers[i].value == '')
                  userAnswers[answers[i].id.toString()] = undefined;
                else
                  if (stringAnswer)
                    userAnswers[answers[i].id.toString()] = answers[i].value.toLowerCase();
                  else
                    userAnswers[answers[i].id.toString()] = answers[i].value;
              }
              
              if (flag_js == false) {
                if (data[x.toString()]['order'] == false)
                  results = checkFillin(correctAnswers, userAnswers, distractorAnswers, 0);
                else
                  results = checkFillin(correctAnswers, userAnswers, distractorAnswers, 1);
                
                allEmpty = true;
                nCorrects = 0;
                
                for (r in results) {
                  if (results[r] == true)
                    nCorrects += 1;
                  if (results[r] != "n/a")
                    allEmpty = false;
                }
                
                if (!allEmpty) {
                  printResults(results, null, explanation, 1);
                  userPoints += calculateMark(data[x.toString()], x.toString(), null, 1, nCorrects, null);
                }
              }
              else {
                nQuestion = parseInt(x.toString().split('-')[1]) + 1;
                id_answer_js = 'qfi' + nQuestion.toString() + '-1';
                result_function = eval(data[x.toString()]['answers'][id_answer_js]['answer_text']);
                
                values = [];
                ids = {};
                $.each(userAnswers, function(k,v) {
                  ids[k] = false;
                  values.push(eval(v));
                });
                
                result = result_function.apply(this, values);     // Execution of the function
                
                if (result) {
                  $.each(ids, function(k,v) {
                    ids[k] = true;
                  });
                }
                
                printResults(ids, null, explanation, 1);
                userPoints += calculateMark(data[x.toString()], x.toString(), result, 2, null, null);
              }
            }
            
            else if (answers.attr('class') == "select") {
              idCorrectAnswer = findCorrectAnswer(x.toString(), 0);
              
              if ($("#" + x.toString() + " :checked").size() != 0) {
                if ($("#" + x.toString() + " :checked").attr('id') == idCorrectAnswer) {
                  printResults($("#" + x.toString() + " :checked").attr('id'), 1, "", 0);
                  correct = true;
                }
                else {
                  id = $("#" + x.toString() + " :checked").attr('id');
                  printResults(id, 0, data[x.toString()]['answers'][id]['explanation'], 0);
                }
                userPoints += calculateMark(data[x.toString()], x.toString(), correct, 2, null, null);
              }
            }
            
            else if (answers.attr('class') == "check"){
              if ($("#" + x.toString() + " :checked").size() != 0) {
                answers = $("#" + x.toString() + " :checked");
                checkedIds = [];
                
                $.each(answers, function(index, value){
                  checkedIds.push(value['id']);
                });
                
                correctIds = [];
                correctIds = findCorrectAnswer(x.toString(), 1);
                checkSelectMultiple(x, checkedIds, correctIds);
              }
            }
          }
          
          else if ($("#" + x.toString() + " div[id^=qddsm").length != 0) {
            answers = $("#" + x.toString() + " div[id^=qddsm");
            userAnswers = {};
            allEmpty = true;
            
            $.each(answers, function(i,v) {
              if (v.value !== undefined)
                allEmpty = false;
            });
            
            if (!allEmpty) {
              for (i = 0; i < answers.length; i++) {
                answer = [];
                for (j = 0; j < answers[i].children.length; j++)
                  answer.push(answers[i].children[j].innerText);
                userAnswers[answers[i].id] = answer;
              }
              
              result = checkDragDropSM(x.toString(), userAnswers);
              userPoints += calculateMark(data[x.toString()], x.toString(), result, 2, null, null);
             }
          }
          
          else {  // Textarea
            numAnswer = parseInt(x.split('-')[1]) + 1;
            idAnswer = 'qp' + numAnswer.toString() + '-1';
            
            answer = eval("fn = " + data[x.toString()]['answers'][idAnswer]['answer_text']);    // Teacher's code
            eval(id_textareas[idAnswer]['editor'].getValue());                                  // Student's code
            
            try {
              result = answer.call();
            }
            catch(err) {
              result = false;
            }
            
            userPoints += calculateMark(data[x.toString()], x.toString(), result, 2, null, null);
          }
        }
      }
      
      function itemExists(item, userAnswer) {
        for (j = 0; j < userAnswer.length; j++) {
          if (item == userAnswer[j])
            return true;
        }
        return false;
      }
      
      function checkDragDropSM(id_question, userAnswers) {
        correctAnswers = {};
        for (x in data[id_question]['answers']) {
          correctAnswers[x] = data[id_question]['answers'][x]['answer_text'];
        }
        
        results = [];
        
        for (x in correctAnswers) {
          correctKeys = correctAnswers[x];
          for (y in correctKeys) {
            item = correctKeys[y];
            if ((typeof(item)) == "object") {
              if (item.length != userAnswers[x].length)         // If there're more or less answers that the number of correct answers
                return false;
              else {
                for (z = 0; z < item.length; z++)
                  results.push(itemExists(item[z], userAnswers[x]));
              }
            }
            else if ((typeof(item)) == "string") {
              if (userAnswers[x].length != 1)
                return false;
              else {
                results.push(itemExists(item, userAnswers[x]));
              }
            }
          }
        }
        
        correction = true;
        
        $.each(results, function(i,v) {
          if (v == false)
            correction = false;
        });
        
        return correction;
      }
      
      function checkAnswers() {
        for (x in data) {
          checkAnswer(x);
        }
      }
      
      function storeAnswers() {
        if(typeof(Storage) !== undefined) {
          tmp = {}
          
          inputText = $('input:text').filter(function() { return $(this).val() != ""; });
          for (i = 0; i < inputText.length; i++) {
            idAnswer = inputText[i].id;
            tmp[idAnswer] = inputText[i].value;
          }
          
          inputRadioCheckBox = $('input:checked');
          for (i = 0; i < inputRadioCheckBox.length; i++) {
            idAnswer = inputRadioCheckBox[i].id;
            nquestion = parseInt(idAnswer.split('-')[0].substr(3)) - 1;
            tmp[idAnswer] = data["question-" + nquestion.toString()]['answers'][idAnswer]['answer_text'];
          }
          
          $.each(id_textareas, function(k,v) {
            tmp[k] = id_textareas[k]['editor'].getValue();
          });
          
          localStorage.setItem(timestamp, JSON.stringify(tmp));
        }
        else {
          alert(i18n[language]['alerts']['noStorage']);
        }
      }
      
      function loadAnswers() {
        if ((localStorage.length != 0) && (localStorage[timestamp] !== undefined)) {
          tmp = JSON.parse(localStorage[timestamp]);
          for (x in tmp) {
            if ((x.match(/qfi/)) || (x.match(/qddfi/)) || (x.match(/qddmc/)))
              $("#" + x.toString()).val(tmp[x.toString()]);
            else if (x.match(/qp/))
              id_textareas[x]['editor'].setValue(tmp[x]);
            else
              $("#" + x.toString()).attr('checked', 'checked');
          }
        }
      }
      
      function deleteAnswers(all) {
        if (all) {
          localStorage.clear();
          alert(i18n[language]['alerts']['storage']);
        }
        else {
          localStorage.removeItem(timestamp);
          alert(i18n[language]['alerts']['answers']);
        }
      }
      
      function showTotalScore() {
        $("#score").html(i18n[language]['questions']['score'] + ": " + userPoints.toFixed(2) + "/" + totalPoints.toFixed(2) + " " + i18n[language]['questions']['points'])
      }
      
      function reload() {
        window.location.reload();
      }
      
      function changeButton(button, numQuestion) {
        if (button.attr('class').match('success')) {
          button.attr('class', button.attr('class').replace('success', 'danger'));
          button.html(i18n[language]['buttons']['hide']);
          showOrHideAnswer(numQuestion, 1);
        }
        else if (button.attr('class').match('danger')){
          button.attr('class', button.attr('class').replace('danger', 'success'));
          button.html(i18n[language]['buttons']['show']);
          showOrHideAnswer(numQuestion, 0);
        }
      }
      
      function clearTextarea() {
        areas = $('textarea');
        $.each(areas, function(i, v) {
          if (v.value.match(/^ +$/))
            v.value = '';
        });
      }
      
      function trimButtons() {
        buttons = $('button');
        $.each(buttons, function(i, v) {
          v.textContent = v.textContent.trim();
        });
      }
      
      function showOrHideAnswer(numQuestion, flag) {
        answers = data['question-' + numQuestion.toString()]['answers'];
        typeQuestion = Object.keys(answers)[0].split('-')[0].slice(0, 3);
        numQuestion = (++numQuestion).toString();
        
        if (typeQuestion.match(/^qfi$/)) {
          inputs = $("input[id^=qfi" + numQuestion + "-");
          
          $.each(inputs, function(index, value) {
            if (flag == 1)
              $("input[id=" + value.id).val(answers[value.id]['answer_text']);
            else
              $("input[id=" + value.id).val('');
          });
        }
        else if (typeQuestion.match(/^qmc$/)){
          inputs = $("input[id^=qmc" + numQuestion + "-");
          correct = '';
          
          $.each(answers, function(key, value) {
            if (value['correct'] == true)
              correct = key;
          })
          
          if (flag == 1)
            $("input[id=" + correct).prop('checked', true);
          else
            $("input[id=" + correct).prop('checked', false);
        }
        else {
          inputs = $("input[id^=qsm" + numQuestion + "-");
          corrects = [];
          $.each(answers, function(key, value) {
            if (answers[key]['correct'] == true)
              corrects.push(key);
          }); 
          
          $.each(corrects, function(index, value) {
            if (flag == 1)
              $("input[id=" + value).prop('checked', true);
            else
              $("input[id=" + value).prop('checked', false);
          });
        }
      }
      
      $("#submit").click(function() {
        checkAnswers();
        filledAllQuiz = true;
        
        for (x in data) {
          if ($("#" + x.toString() + " strong").length == 0)
            filledAllQuiz = false; 
        }
        if (filledAllQuiz)
          $("#submit").detach();
        
        storeAnswers();
        showTotalScore();
      });

      $("#reset").click(function() {
        reload();
      });
      
      $("#deleteAnswers").click(function() {
        deleteAnswers(false);
        reload();
      });
      
      $("#deleteStorage").click(function() {
        deleteAnswers(true);
        reload();
      });
      
      $("button[id^=show-answer-q-").click(function() {
        numQuestion = parseInt($(this).attr('id').split('-')[3]);
        changeButton($(this), numQuestion);
      });
      
      $("button[id^=q-").click(function() {
        nQuestion = $(this).attr('id').split('-')[1];
        checkAnswer('question-' + nQuestion);
        storeAnswers();
        showTotalScore();
      });
      
      $(document).ready(function() {
        loadAnswers();
        clearTextarea();
        trimButtons();
      });
    </script>
  </body>
</html>
